# =========================
# DEFAULT (LOCAL DEVELOPMENT)
# =========================
server:
  port: 8087

spring:
  application:
    name: gateway
  cloud:
    gateway:
      # Route to Eureka-registered services using lb://SERVICE-ID
      routes:
        - id: notification
          uri: lb://notification-service
          predicates:
            - Path=/api/email/**,/api/qr/**
        - id: stall
          uri: lb://stall-service
          predicates:
            - Path=/api/bookfairs/**,/api/stall-allocations/**,/api/stalls/**
        - id: vendor
          uri: lb://user-service
          predicates:
            - Path=/api/me/**,/api/users/**,/auth/**,/api/stall-users/**,
      default-filters:
        # Good hygiene: strip cookies by default (adjust as needed)
        - name: RemoveRequestHeader
          args:
            name: Cookie
        # Propagate a correlation id if not present
        - name: AddRequestHeader
          args:
            name: X-Correlation-Id
            value: "#{T(java.util.UUID).randomUUID().toString()}"
    loadbalancer:
      # Optional: retry/load-balancer tuning
      ribbon:
        enabled: false

security:
  oauth2:
    resourceserver:
      jwt:
        secret: ${SECURITY_JWT_SECRET}


# Eureka client (gateway registers itself and discovers others)
eureka:
  client:
    service-url:
      defaultZone: http://localhost:8761/eureka
    fetch-registry: true
    register-with-eureka: true
  instance:
    prefer-ip-address: true
    instance-id: ${spring.application.name}:${random.value}

management:
  endpoints:
    web:
      exposure:
        include: health,info
  endpoint:
    health:
      probes:
        enabled: true